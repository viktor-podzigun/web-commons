/*! bootstrap-calendar - v0.2.3 - 2014-02-11 - https://github.com/Serhioromano/bootstrap-calendar */
"use strict";Date.prototype.getWeek=function(){var e=new Date(this.getFullYear(),0,1);return Math.ceil(((this.getTime()-e.getTime())/864e5+e.getDay()+1)/7)};Date.prototype.getMonthFormatted=function(){var e=this.getMonth()+1;return e<10?"0"+e:e};Date.prototype.getDateFormatted=function(){var e=this.getDate();return e<10?"0"+e:e};if(!String.prototype.format){String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,n){return typeof e[n]!="undefined"?e[n]:t})}}if(!String.prototype.formatNum){String.prototype.formatNum=function(e){var t=""+this;while(t.length<e)t="0"+t;return t}}(function(e){function o(e,t){var n,r,i;i=e;n=e.indexOf("?")<0?"?":"&";for(r in t){i+=n+r+"="+encodeURIComponent(t[r]);n="&"}return i}function u(t,r){var i=t.options[r]!=null?t.options[r]:null;var s=t.locale[r]!=null?t.locale[r]:null;if(r=="holidays"&&t.options.merge_holidays){var o={};e.extend(true,o,s?s:n.holidays);if(i){e.extend(true,o,i)}return o}else{if(i!=null){return i}if(s!=null){return s}return n[r]}}function a(t,n){var r=[];var i=u(t,"holidays");for(var s in i){r.push(s+":"+i[s])}r.push(n);r=r.join("|");if(r in a.cache){return a.cache[r]}var o=[];e.each(i,function(t,r){var i=null,s=null,u=false;e.each(t.split(">"),function(e,r){var o,a=null;if(o=/^(\d\d)-(\d\d)$/.exec(r)){a=new Date(n,parseInt(o[2],10)-1,parseInt(o[1],10))}else if(o=/^(\d\d)-(\d\d)-(\d\d\d\d)$/.exec(r)){if(parseInt(o[3],10)==n){a=new Date(n,parseInt(o[2],10)-1,parseInt(o[1],10))}}else if(o=/^easter(([+\-])(\d+))?$/.exec(r)){a=h(n,o[1]?parseInt(o[1],10):0)}else if(o=/^(\d\d)([+\-])([1-5])\*([0-6])$/.exec(r)){var l=parseInt(o[1],10)-1;var c=o[2];var p=parseInt(o[3]);var d=parseInt(o[4]);switch(c){case"+":var v=new Date(n,l,1-7);while(v.getDay()!=d){v=new Date(v.getFullYear(),v.getMonth(),v.getDate()+1)}a=new Date(v.getFullYear(),v.getMonth(),v.getDate()+7*p);break;case"-":var v=new Date(n,l+1,0+7);while(v.getDay()!=d){v=new Date(v.getFullYear(),v.getMonth(),v.getDate()-1)}a=new Date(v.getFullYear(),v.getMonth(),v.getDate()-7*p);break}}if(!a){f("Unknown holiday: "+t);u=true;return false}switch(e){case 0:i=a;break;case 1:if(a.getTime()<=i.getTime()){f("Unknown holiday: "+t);u=true;return false}s=a;break;default:f("Unknown holiday: "+t);u=true;return false}});if(!u){var a=[];if(s){for(var l=new Date(i.getTime());l.getTime()<=s.getTime();l.setDate(l.getDate()+1)){a.push(new Date(l.getTime()))}}else{a.push(i)}o.push({name:r,days:a})}});a.cache[r]=o;return a.cache[r]}function f(t){if(e.type(window.console)=="object"&&e.type(window.console.warn)=="function"){window.console.warn("[Bootstrap-Calendar] "+t)}}function l(n,r){this.options=e.extend(true,{position:{start:new Date,end:new Date}},t,n);this.setLanguage(this.options.language);this.context=r;r.css("width",this.options.width).addClass("cal-context");this.view();return this}function c(t,n,r,i){t.stopPropagation();var n=e(n);var s=n.closest(".cal-cell");var o=s.closest(".cal-before-eventlist");var u=s.data("cal-row");n.fadeOut("fast");r.slideUp(0,function(){var t=e(".events-list",s);r.html(i.options.templates["events-list"]({cal:i,events:i.getEventsBetween(parseInt(t.data("cal-start")),parseInt(t.data("cal-end")))}));o.after(r);i.activecell=e("[data-cal-date]",s).text();e("#cal-slide-tick").addClass("tick"+u).show();r.slideDown("fast",function(){e("body").one("click",function(){r.slideUp("fast");i.activecell=0})})});e("a.event-item").mouseenter(function(){e('a[data-event-id="'+e(this).data("event-id")+'"]').closest(".cal-cell1").addClass("day-highlight dh-"+e(this).data("event-class"))});e("a.event-item").mouseleave(function(){e("div.cal-cell1").removeClass("day-highlight dh-"+e(this).data("event-class"))});i._update_modal()}function h(e,t){var n=e%19;var r=Math.floor(e/100);var i=e%100;var s=Math.floor(r/4);var o=r%4;var u=Math.floor((r+8)/25);var a=Math.floor((r-u+1)/3);var f=(19*n+r-s-a+15)%30;var l=Math.floor(i/4);var c=i%4;var h=(32+2*o+2*l-f-c)%7;var p=Math.floor((n+11*f+22*h)/451);var d=f+h+7*p+114;var v=Math.floor(d/31)-1;var m=d%31+1;return new Date(e,v,m+(t?t:0),0,0,0)}var t={width:"100%",view:"month",day:"now",time_start:"06:00",time_end:"22:00",time_split:"30",events_source:"",tmpl_path:"tmpls/",tmpl_cache:true,classes:{months:{inmonth:"cal-day-inmonth",outmonth:"cal-day-outmonth",saturday:"cal-day-weekend",sunday:"cal-day-weekend",holidays:"cal-day-holiday",today:"cal-day-today"},week:{workday:"cal-day-workday",saturday:"cal-day-weekend",sunday:"cal-day-weekend",holidays:"cal-day-holiday",today:"cal-day-today"}},modal:null,modal_type:"iframe",modal_title:null,views:{year:{slide_events:1,enable:1},month:{slide_events:1,enable:1},week:{enable:1},day:{enable:1}},merge_holidays:false,onAfterEventsLoad:function(e){},onBeforeEventsLoad:function(e){e()},onAfterViewLoad:function(e){},events:[],templates:{year:"",month:"",week:"",day:""},stop_cycling:false};var n={first_day:2,holidays:{"01-01":"New Year's Day","01+3*1":"Birthday of Dr. Martin Luther King, Jr.","02+3*1":"Washington's Birthday","05-1*1":"Memorial Day","04-07":"Independence Day","09+1*1":"Labor Day","10+2*1":"Columbus Day","11-11":"Veterans Day","11+4*4":"Thanksgiving Day","25-12":"Christmas"}};var r={error_noview:"Calendar: View {0} not found",error_dateformat:'Calendar: Wrong date format {0}. Should be either "now" or "yyyy-mm-dd"',error_loadurl:"Calendar: Event URL is not set",error_where:'Calendar: Wrong navigation direction {0}. Can be only "next" or "prev" or "today"',error_timedevide:"Calendar: Time split parameter should divide 60 without decimals. Something like 10, 15, 30",no_events_in_day:"No events in this day.",title_year:"{0}",title_month:"{0} {1}",title_week:"week {0} of {1}",title_day:"{0} {1} {2}, {3}",week:"Week {0}",all_day:"All day",time:"Time",events:"Events",before_time:"Ends before timeline",after_time:"Starts after timeline",m0:"January",m1:"February",m2:"March",m3:"April",m4:"May",m5:"June",m6:"July",m7:"August",m8:"September",m9:"October",m10:"November",m11:"December",ms0:"Jan",ms1:"Feb",ms2:"Mar",ms3:"Apr",ms4:"May",ms5:"Jun",ms6:"Jul",ms7:"Aug",ms8:"Sep",ms9:"Oct",ms10:"Nov",ms11:"Dec",d0:"Sunday",d1:"Monday",d2:"Tuesday",d3:"Wednesday",d4:"Thursday",d5:"Friday",d6:"Saturday"};var i="";try{if(e.type(window.jstz)=="object"&&e.type(jstz.determine)=="function"){i=jstz.determine().name();if(e.type(i)!=="string"){i=""}}}catch(s){}a.cache={};l.prototype.setOptions=function(t){e.extend(this.options,t);if("language"in t){this.setLanguage(t.language)}if("modal"in t){this._update_modal()}};l.prototype.setLanguage=function(t){if(window.calendar_languages&&t in window.calendar_languages){this.locale=e.extend(true,{},r,calendar_languages[t]);this.options.language=t}else{this.locale=r;delete this.options.language}};l.prototype._render=function(){this.context.html("");this._loadTemplate(this.options.view);this.stop_cycling=false;var e={};e.cal=this;e.day=1;if(u(this,"first_day")==1){e.months=[this.locale.d1,this.locale.d2,this.locale.d3,this.locale.d4,this.locale.d5,this.locale.d6,this.locale.d0]}else{e.months=[this.locale.d0,this.locale.d1,this.locale.d2,this.locale.d3,this.locale.d4,this.locale.d5,this.locale.d6]}var t=parseInt(this.options.position.start.getTime());var n=parseInt(this.options.position.end.getTime());e.events=this.getEventsBetween(t,n);switch(this.options.view){case"month":break;case"week":this._calculate_hour_minutes(e);break;case"day":this._calculate_hour_minutes(e);break}e.start=new Date(this.options.position.start.getTime());e.lang=this.locale;this.context.append(this.options.templates[this.options.view](e));this._update()};l.prototype._calculate_hour_minutes=function(t){var n=this;t.in_hour=60/parseInt(this.options.time_split);t.hour_split=parseInt(this.options.time_split);if(!/^\d+$/.exec(t.in_hour)||this.options.time_split>30){e.error(this.locale.error_timedevide)}var r=this.options.time_start.split(":");var i=this.options.time_end.split(":");t.hours=parseInt(i[0])-parseInt(r[0]);var s=t.hours*t.in_hour;var o=6e4*parseInt(this.options.time_split);var u=new Date(this.options.position.start.getTime());u.setHours(r[0]);u.setMinutes(r[1]);var a=new Date(this.options.position.start.getTime());a.setHours(i[0]);a.setMinutes(i[1]);t.all_day=[];t.by_hour=[];t.after_time=[];t.before_time=[];e.each(t.events,function(e,r){var i=new Date(parseInt(r.start));var l=new Date(parseInt(r.end));r.start_hour=i.getHours().toString().formatNum(2)+":"+i.getMinutes().toString().formatNum(2);r.end_hour=l.getHours().toString().formatNum(2)+":"+l.getMinutes().toString().formatNum(2);if(r.start<u.getTime()){f(1);r.start_hour=i.getDate()+" "+n.locale["ms"+i.getMonth()]+" "+r.start_hour}if(r.end>a.getTime()){f(1);r.end_hour=l.getDate()+" "+n.locale["ms"+l.getMonth()]+" "+r.end_hour}if(r.start<u.getTime()&&r.end>a.getTime()){t.all_day.push(r);return}if(r.end<u.getTime()){t.before_time.push(r);return}if(r.start>a.getTime()){t.after_time.push(r);return}var c=u.getTime()-r.start;if(c>=0){r.top=0}else{r.top=Math.abs(c)/o}var h=s-r.top;var p=(r.end-r.start)/o;if(c>=0){p=(r.end-u.getTime())/o}r.lines=p;if(p>h){r.lines=h}t.by_hour.push(r)})};l.prototype._hour=function(e,t){var n=this.options.time_start.split(":");var e=""+(parseInt(n[0])+e);var r=""+this.options.time_split*t;return e.formatNum(2)+":"+r.formatNum(2)};l.prototype._week=function(t){this._loadTemplate("week-days");var n={};var r=parseInt(this.options.position.start.getTime());var i=parseInt(this.options.position.end.getTime());var s=[];var o=this;var a=u(this,"first_day");e.each(this.getEventsBetween(r,i),function(e,t){t.start_day=(new Date(parseInt(t.start))).getDay();if(a==1){t.start_day=(t.start_day+6)%7}if(t.end-t.start<=864e5){t.days=1}else{t.days=(t.end-t.start)/864e5}if(t.start<r){t.days=t.days-(r-t.start)/864e5;t.start_day=0}t.days=Math.ceil(t.days);if(t.start_day+t.days>7){t.days=7-t.start_day}s.push(t)});n.events=s;n.cal=this;return o.options.templates["week-days"](n)};l.prototype._month=function(e){this._loadTemplate("year-month");var t={cal:this};var n=e+1;t.data_day=this.options.position.start.getFullYear()+"-"+(n<10?"0"+n:n)+"-"+"01";t.month_name=this.locale["m"+e];var r=new Date(this.options.position.start.getFullYear(),e,1,0,0,0);t.start=parseInt(r.getTime());t.end=parseInt((new Date(this.options.position.start.getFullYear(),e+1,1,0,0,0)).getTime());t.events=this.getEventsBetween(t.start,t.end);return this.options.templates["year-month"](t)};l.prototype._day=function(t,n){this._loadTemplate("month-day");var r={tooltip:"",cal:this};var i=this.options.classes.months.outmonth;var s=this.options.position.start.getDay();if(u(this,"first_day")==2){s++}else{s=s==0?7:s}n=n-s+1;var o=new Date(this.options.position.start.getFullYear(),this.options.position.start.getMonth(),n,0,0,0);if(n>0){i=this.options.classes.months.inmonth}var a=(new Date(this.options.position.end.getTime()-1)).getDate();if(n+1>a){this.stop_cycling=true}if(n>a){n=n-a;i=this.options.classes.months.outmonth}i=e.trim(i+" "+this._getDayClass("months",o));if(n<=0){var f=(new Date(this.options.position.start.getFullYear(),this.options.position.start.getMonth(),0)).getDate();n=f-Math.abs(n);i+=" cal-month-first-row"}var l=this._getHoliday(o);if(l!==false){r.tooltip=l}r.data_day=o.getFullYear()+"-"+o.getMonthFormatted()+"-"+(n<10?"0"+n:n);r.cls=i;r.day=n;r.start=parseInt(o.getTime());r.end=parseInt(r.start+864e5);r.events=this.getEventsBetween(r.start,r.end);return this.options.templates["month-day"](r)};l.prototype._getHoliday=function(t){var n=false;e.each(a(this,t.getFullYear()),function(){var r=false;e.each(this.days,function(){if(this.toDateString()==t.toDateString()){r=true;return false}});if(r){n=this.name;return false}});return n};l.prototype._getHolidayName=function(e){var t=this._getHoliday(e);return t===false?"":t};l.prototype._getDayClass=function(e,t){var n=this;var r=function(t,r){var i;i=n.options.classes&&e in n.options.classes&&t in n.options.classes[e]?n.options.classes[e][t]:"";if(typeof i=="string"&&i.length){r.push(i)}};var i=[];if(t.toDateString()==(new Date).toDateString()){r("today",i)}var s=this._getHoliday(t);if(s!==false){r("holidays",i)}switch(t.getDay()){case 0:r("sunday",i);break;case 6:r("saturday",i);break}return i.join(" ")};l.prototype.view=function(e){if(e){if(!this.options.views[e].enable){return}this.options.view=e}this._init_position();this._loadEvents();this._render();this.options.onAfterViewLoad.call(this,this.options.view)};l.prototype.navigate=function(t,n){var r=e.extend({},this.options.position);if(t=="next"){switch(this.options.view){case"year":r.start.setFullYear(this.options.position.start.getFullYear()+1);break;case"month":r.start.setMonth(this.options.position.start.getMonth()+1);break;case"week":r.start.setDate(this.options.position.start.getDate()+7);break;case"day":r.start.setDate(this.options.position.start.getDate()+1);break}}else if(t=="prev"){switch(this.options.view){case"year":r.start.setFullYear(this.options.position.start.getFullYear()-1);break;case"month":r.start.setMonth(this.options.position.start.getMonth()-1);break;case"week":r.start.setDate(this.options.position.start.getDate()-7);break;case"day":r.start.setDate(this.options.position.start.getDate()-1);break}}else if(t=="today"){r.start.setTime((new Date).getTime())}else{e.error(this.locale.error_where.format(t))}this.options.day=r.start.getFullYear()+"-"+r.start.getMonthFormatted()+"-"+r.start.getDateFormatted();this.view();if(_.isFunction(n)){n()}};l.prototype._init_position=function(){var t,n,r;if(this.options.day=="now"){var i=new Date;t=i.getFullYear();n=i.getMonth();r=i.getDate()}else if(this.options.day.match(/^\d{4}-\d{2}-\d{2}$/g)){var s=this.options.day.split("-");t=parseInt(s[0],10);n=parseInt(s[1],10)-1;r=parseInt(s[2],10)}else{e.error(this.locale.error_dateformat.format(this.options.day))}switch(this.options.view){case"year":this.options.position.start.setTime((new Date(t,0,1)).getTime());this.options.position.end.setTime((new Date(t+1,0,1)).getTime());break;case"month":this.options.position.start.setTime((new Date(t,n,1)).getTime());this.options.position.end.setTime((new Date(t,n+1,1)).getTime());break;case"day":this.options.position.start.setTime((new Date(t,n,r)).getTime());this.options.position.end.setTime((new Date(t,n,r+1)).getTime());break;case"week":var o=new Date(t,n,r);var a;if(u(this,"first_day")==1){a=o.getDate()-(o.getDay()+6)%7}else{a=o.getDate()-o.getDay()}this.options.position.start.setTime((new Date(t,n,a)).getTime());this.options.position.end.setTime((new Date(t,n,a+7)).getTime());break;default:e.error(this.locale.error_noview.format(this.options.view))}return this};l.prototype.getTitle=function(){var e=this.options.position.start;switch(this.options.view){case"year":return this.locale.title_year.format(e.getFullYear());break;case"month":return this.locale.title_month.format(this.locale["m"+e.getMonth()],e.getFullYear());break;case"week":return this.locale.title_week.format(e.getWeek(),e.getFullYear());break;case"day":return this.locale.title_day.format(this.locale["d"+e.getDay()],e.getDate(),this.locale["m"+e.getMonth()],e.getFullYear());break}return};l.prototype.isToday=function(){var e=(new Date).getTime();return e>this.options.position.start&&e<this.options.position.end};l.prototype.getStartDate=function(){return this.options.position.start};l.prototype.getEndDate=function(){return this.options.position.end};l.prototype._loadEvents=function(){var t=this;var n=null;if("events_source"in this.options&&this.options.events_source!==""){n=this.options.events_source}else if("events_url"in this.options){n=this.options.events_url;f("The events_url option is DEPRECATED and it will be REMOVED in near future. Please use events_source instead.")}var r;switch(e.type(n)){case"function":r=function(){return n(t.options.position.start,t.options.position.end,i)};break;case"array":r=function(){return[].concat(n)};break;case"string":if(n.length){r=function(){var r=[];var s={from:t.options.position.start.getTime(),to:t.options.position.end.getTime()};if(i.length){s.browser_timezone=i}e.ajax({url:o(n,s),dataType:"json",type:"GET",async:false}).done(function(t){if(!t.success){e.error(t.error)}if(t.result){r=t.result}});return r}}break}if(!r){e.error(this.locale.error_loadurl)}this.options.onBeforeEventsLoad.call(this,function(){t.options.events=r();t.options.events.sort(function(e,t){var n;n=e.start-t.start;if(n==0){n=e.end-t.end}return n});t.options.onAfterEventsLoad.call(t,t.options.events)})};l.prototype._loadTemplate=function(t){if(this.options.templates[t]){return}var n=this;e.ajax({url:this.options.tmpl_path+t+".html",dataType:"html",type:"GET",async:false,cache:this.options.tmpl_cache}).done(function(e){n.options.templates[t]=_.template(e)})};l.prototype._update=function(){var t=this;e('*[data-toggle="tooltip"]').tooltip({container:"body"});e("*[data-cal-date]").click(function(){var n=e(this).data("cal-view");t.options.day=e(this).data("cal-date");t.view(n)});e(".cal-cell").dblclick(function(){var n=e("[data-cal-date]",this).data("cal-view");t.options.day=e("[data-cal-date]",this).data("cal-date");t.view(n)});this["_update_"+this.options.view]();this._update_modal()};l.prototype._update_modal=function(){var t=this;e("a[data-event-id]",this.context).unbind("click");if(!t.options.modal){return}var n=e(t.options.modal);if(!n.length){return}var r=null;if(t.options.modal_type=="iframe"){r=e(document.createElement("iframe")).attr({width:"100%",frameborder:"0"})}e("a[data-event-id]",this.context).on("click",function(i){i.preventDefault();i.stopPropagation();var s=e(this).attr("href");var o=e(this).data("event-id");var i=_.find(t.options.events,function(e){return e.id==o});if(t.options.modal_type=="iframe"){r.attr("src",s);e(".modal-body",n).html(r)}if(!n.data("handled.bootstrap-calendar")||n.data("handled.bootstrap-calendar")&&n.data("handled.event-id")!=i.id){n.on("show.bs.modal",function(){var r=e(this).find(".modal-body");switch(t.options.modal_type){case"iframe":var o=r.height()-parseInt(r.css("padding-top"),10)-parseInt(r.css("padding-bottom"),10);e(this).find("iframe").height(Math.max(o,50));break;case"ajax":e.ajax({url:s,dataType:"html",async:false,success:function(e){r.html(e)}});break;case"template":t._loadTemplate("modal");r.html(t.options.templates["modal"]({event:i,calendar:t}));break}if(_.isFunction(t.options.modal_title)){n.find("h3").html(t.options.modal_title(i))}}).data("handled.bootstrap-calendar",true).data("handled.event-id",i.id)}n.modal("show")})};l.prototype._update_day=function(){e("#cal-day-panel").height(e("#cal-day-panel-hour").height())};l.prototype._update_week=function(){};l.prototype._update_year=function(){this._update_month_year()};l.prototype._update_month=function(){this._update_month_year();var t=this;var n=e(document.createElement("div")).attr("id","cal-week-box");var r=this.options.position.start.getFullYear()+"-"+this.options.position.start.getMonthFormatted()+"-";e(".cal-month-box .cal-row-fluid").on("mouseenter",function(){var i=new Date(t.options.position.start);var s=e(".cal-cell1:first-child .cal-month-day",this);var o=s.hasClass("cal-month-first-row")?1:e("[data-cal-date]",s).text();i.setDate(parseInt(o));o=o<10?"0"+o:o;n.html(t.locale.week.format(i.getWeek()));n.attr("data-cal-week",r+o).show().appendTo(s)}).on("mouseleave",function(){n.hide()});n.click(function(){t.options.day=e(this).data("cal-week");t.view("week")});e("a.event").mouseenter(function(){e('a[data-event-id="'+e(this).data("event-id")+'"]').closest(".cal-cell1").addClass("day-highlight dh-"+e(this).data("event-class"))});e("a.event").mouseleave(function(){e("div.cal-cell1").removeClass("day-highlight dh-"+e(this).data("event-class"))})};l.prototype._update_month_year=function(){if(!this.options.views[this.options.view].slide_events){return}var t=this;var n=0;var r=e(document.createElement("div")).attr("id","cal-day-tick").html('<i class="icon-chevron-down glyphicon glyphicon-chevron-down"></i>');e(".cal-month-day, .cal-year-box .span3").on("mouseenter",function(){if(e(".events-list",this).length==0)return;if(e(this).children("[data-cal-date]").text()==t.activecell)return;r.show().appendTo(this)}).on("mouseleave",function(){r.hide()}).on("click",function(n){if(e(".events-list",this).length==0)return;if(e(this).children("[data-cal-date]").text()==t.activecell)return;c(n,r,i,t)});var i=e(document.createElement("div")).attr("id","cal-slide-box");i.hide().click(function(e){e.stopPropagation()});this._loadTemplate("events-list");r.click(function(n){c(n,e(this),i,t)})};l.prototype.getEventsBetween=function(t,n){var r=[];e.each(this.options.events,function(){if((parseInt(this.start)<n||this.start==null)&&(parseInt(this.end)>=t||this.end==null)){r.push(this)}});return r};e.fn.calendar=function(e){return new l(e,this)}})(jQuery)